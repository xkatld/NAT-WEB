{% extends 'layout.html' %}

{% block content %}
<h2 class="mb-3">当前 NAT 规则 (来自数据库)</h2> {# Add bottom margin #}

{# 使用 Bootstrap button styling for Add link #}
<a href="{{ url_for('add_rule') }}" class="btn btn-primary mb-3">添加新规则</a> {# Primary button with bottom margin #}

{# Apply All Rules form #}
<form action="{{ url_for('apply_all') }}" method="post" onsubmit="return confirm('您确定要清空所有当前 NAT 规则并从数据库重新应用吗？');" class="mb-3"> {# Add bottom margin #}
    <button type="submit" class="btn btn-warning">清空并应用所有数据库规则</button> {# Warning button style #}
    <p class="text-muted mt-2">警告：这将刷新您系统上现有的 NAT 规则，并仅应用下方列表中的规则。</p> {# Muted text for warning #}
</form>

{% if rules %}
<div class="table-responsive"> {# Wrap table in responsive div for smaller screens #}
    <table class="table table-striped table-bordered table-hover"> {# Add table classes #}
        <thead class="table-light"> {# Light header #}
            <tr>
                <th>ID</th>
                <th>链</th>
                <th>协议</th>
                <th>源</th>
                <th>目标</th>
                <th>入站接口</th>
                <th>出站接口</th>
                <th>源端口</th>
                <th>目标端口</th>
                <th>目标动作</th>
                <th>目标地址转换</th>
                <th>源地址转换</th>
                <th>描述</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for rule in rules %}
            <tr>
                <td>{{ rule.id }}</td>
                <td>{{ rule.chain }}</td>
                <td>{{ rule.protocol or '任意' }}</td>
                <td>{{ rule.source or '任意' }}</td>
                <td>{{ rule.destination or '任意' }}</td>
                <td>{{ rule.in_interface or '任意' }}</td>
                <td>{{ rule.out_interface or '任意' }}</td>
                <td>{{ rule.source_port or '任意' }}</td>
                <td>{{ rule.destination_port or '任意' }}</td>
                <td>{{ rule.target }}</td>
                <td>{{ rule.to_destination or '-' }}</td>
                <td>{{ rule.to_source or '-' }}</td>
                <td>{{ rule.description or '-' }}</td>
                <td>
                    <form action="{{ url_for('delete_rule', rule_id=rule.id) }}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('您确定要删除这条规则吗？');">删除</button> {# Danger button, small size #}
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info" role="alert">
    数据库中没有找到 NAT 规则。
</div>
{% endif %}

{% endblock %}
